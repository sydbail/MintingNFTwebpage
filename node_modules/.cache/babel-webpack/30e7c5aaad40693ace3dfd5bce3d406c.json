{"ast":null,"code":"'use strict';\n\nvar _asyncToGenerator = require(\"/Users/sydneybailey/Internship/Demo/node_modules/@babel/runtime/helpers/asyncToGenerator\").default;\n\nconst utils = require('../../utils');\n\nconst errcode = require('err-code');\n/**\n * @typedef {import('peer-id')} PeerId\n * @typedef {import('../../message')} Message\n */\n\n/**\n * @param {import('../../index')} dht\n */\n\n\nmodule.exports = dht => {\n  const log = utils.logger(dht.peerId, 'rpc:put-value');\n  /**\n   * Process `PutValue` DHT messages.\n   *\n   * @param {PeerId} peerId\n   * @param {Message} msg\n   */\n\n  function putValue(_x, _x2) {\n    return _putValue.apply(this, arguments);\n  }\n\n  function _putValue() {\n    _putValue = _asyncToGenerator(function* (peerId, msg) {\n      const key = msg.key;\n      log('key: %b', key);\n      const record = msg.record;\n\n      if (!record) {\n        const errMsg = `Empty record from: ${peerId.toB58String()}`;\n        log.error(errMsg);\n        throw errcode(new Error(errMsg), 'ERR_EMPTY_RECORD');\n      }\n\n      yield dht._verifyRecordLocally(record);\n      record.timeReceived = new Date();\n      const recordKey = utils.bufferToKey(record.key);\n      yield dht.datastore.put(recordKey, record.serialize());\n      dht.onPut(record, peerId);\n      return msg;\n    });\n    return _putValue.apply(this, arguments);\n  }\n\n  return putValue;\n};","map":{"version":3,"sources":["/Users/sydneybailey/Internship/Demo/node_modules/libp2p-kad-dht/src/rpc/handlers/put-value.js"],"names":["utils","require","errcode","module","exports","dht","log","logger","peerId","putValue","msg","key","record","errMsg","toB58String","error","Error","_verifyRecordLocally","timeReceived","Date","recordKey","bufferToKey","datastore","put","serialize","onPut"],"mappings":"AAAA;;;;AAEA,MAAMA,KAAK,GAAGC,OAAO,CAAC,aAAD,CAArB;;AACA,MAAMC,OAAO,GAAGD,OAAO,CAAC,UAAD,CAAvB;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AACAE,MAAM,CAACC,OAAP,GAAkBC,GAAD,IAAS;AACxB,QAAMC,GAAG,GAAGN,KAAK,CAACO,MAAN,CAAaF,GAAG,CAACG,MAAjB,EAAyB,eAAzB,CAAZ;AAEA;AACF;AACA;AACA;AACA;AACA;;AAR0B,WASTC,QATS;AAAA;AAAA;;AAAA;AAAA,kCASxB,WAAyBD,MAAzB,EAAiCE,GAAjC,EAAsC;AACpC,YAAMC,GAAG,GAAGD,GAAG,CAACC,GAAhB;AACAL,MAAAA,GAAG,CAAC,SAAD,EAAYK,GAAZ,CAAH;AAEA,YAAMC,MAAM,GAAGF,GAAG,CAACE,MAAnB;;AAEA,UAAI,CAACA,MAAL,EAAa;AACX,cAAMC,MAAM,GAAI,sBAAqBL,MAAM,CAACM,WAAP,EAAqB,EAA1D;AAEAR,QAAAA,GAAG,CAACS,KAAJ,CAAUF,MAAV;AACA,cAAMX,OAAO,CAAC,IAAIc,KAAJ,CAAUH,MAAV,CAAD,EAAoB,kBAApB,CAAb;AACD;;AAED,YAAMR,GAAG,CAACY,oBAAJ,CAAyBL,MAAzB,CAAN;AAEAA,MAAAA,MAAM,CAACM,YAAP,GAAsB,IAAIC,IAAJ,EAAtB;AACA,YAAMC,SAAS,GAAGpB,KAAK,CAACqB,WAAN,CAAkBT,MAAM,CAACD,GAAzB,CAAlB;AACA,YAAMN,GAAG,CAACiB,SAAJ,CAAcC,GAAd,CAAkBH,SAAlB,EAA6BR,MAAM,CAACY,SAAP,EAA7B,CAAN;AAEAnB,MAAAA,GAAG,CAACoB,KAAJ,CAAUb,MAAV,EAAkBJ,MAAlB;AAEA,aAAOE,GAAP;AACD,KA/BuB;AAAA;AAAA;;AAiCxB,SAAOD,QAAP;AACD,CAlCD","sourcesContent":["'use strict'\n\nconst utils = require('../../utils')\nconst errcode = require('err-code')\n\n/**\n * @typedef {import('peer-id')} PeerId\n * @typedef {import('../../message')} Message\n */\n\n/**\n * @param {import('../../index')} dht\n */\nmodule.exports = (dht) => {\n  const log = utils.logger(dht.peerId, 'rpc:put-value')\n\n  /**\n   * Process `PutValue` DHT messages.\n   *\n   * @param {PeerId} peerId\n   * @param {Message} msg\n   */\n  async function putValue (peerId, msg) {\n    const key = msg.key\n    log('key: %b', key)\n\n    const record = msg.record\n\n    if (!record) {\n      const errMsg = `Empty record from: ${peerId.toB58String()}`\n\n      log.error(errMsg)\n      throw errcode(new Error(errMsg), 'ERR_EMPTY_RECORD')\n    }\n\n    await dht._verifyRecordLocally(record)\n\n    record.timeReceived = new Date()\n    const recordKey = utils.bufferToKey(record.key)\n    await dht.datastore.put(recordKey, record.serialize())\n\n    dht.onPut(record, peerId)\n\n    return msg\n  }\n\n  return putValue\n}\n"]},"metadata":{},"sourceType":"script"}