{"ast":null,"code":"'use strict';\n\nvar _asyncToGenerator = require(\"/Users/sydneybailey/Internship/Dapp/node_modules/@babel/runtime/helpers/asyncToGenerator\").default;\n\nvar _wrapAsyncGenerator = require(\"/Users/sydneybailey/Internship/Dapp/node_modules/@babel/runtime/helpers/wrapAsyncGenerator\").default;\n\nvar _awaitAsyncGenerator = require(\"/Users/sydneybailey/Internship/Dapp/node_modules/@babel/runtime/helpers/awaitAsyncGenerator\").default;\n\nvar _asyncIterator = require(\"/Users/sydneybailey/Internship/Dapp/node_modules/@babel/runtime/helpers/asyncIterator\").default;\n\nvar _asyncGeneratorDelegate = require(\"/Users/sydneybailey/Internship/Dapp/node_modules/@babel/runtime/helpers/asyncGeneratorDelegate\").default;\n\nconst map = require('it-map');\n\nconst errCode = require('err-code');\n\nconst {\n  PinTypes\n} = require('./pins');\n/**\n * @typedef {import('interface-datastore').Query} Query\n * @typedef {import('interface-datastore').Datastore} Datastore\n * @typedef {import('interface-datastore').Options} DatastoreOptions\n * @typedef {import('interface-blockstore').Blockstore} Blockstore\n * @typedef {import('multiformats/cid').CID} CID\n * @typedef {import('./pins').Pins} Pins\n */\n\n/**\n *\n * @param {Blockstore} blockstore\n */\n\n\nmodule.exports = createPinnedBlockstore;\n/**\n * @param {Pins} pins\n * @param {Blockstore} store\n * @returns {Blockstore}\n */\n\nfunction createPinnedBlockstore(pins, store) {\n  return {\n    open() {\n      return store.open();\n    },\n\n    close() {\n      return store.close();\n    },\n\n    query(query, options) {\n      return store.query(query, options);\n    },\n\n    queryKeys(query, options) {\n      return store.queryKeys(query, options);\n    },\n\n    get(cid, options) {\n      return _asyncToGenerator(function* () {\n        return store.get(cid, options);\n      })();\n    },\n\n    getMany(cids, options) {\n      return _wrapAsyncGenerator(function* () {\n        yield* _asyncGeneratorDelegate(_asyncIterator(store.getMany(cids, options)), _awaitAsyncGenerator);\n      })();\n    },\n\n    put(cid, buf, options) {\n      return _asyncToGenerator(function* () {\n        yield store.put(cid, buf, options);\n      })();\n    },\n\n    putMany(pairs, options) {\n      return _wrapAsyncGenerator(function* () {\n        yield* _asyncGeneratorDelegate(_asyncIterator(store.putMany(pairs, options)), _awaitAsyncGenerator);\n      })();\n    },\n\n    has(cid, options) {\n      return store.has(cid, options);\n    },\n\n    delete(cid, options) {\n      return _asyncToGenerator(function* () {\n        yield ensureNotPinned(cid, pins);\n        return store.delete(cid, options);\n      })();\n    },\n\n    deleteMany(cids, options) {\n      return store.deleteMany(map(cids, /*#__PURE__*/function () {\n        var _ref = _asyncToGenerator(function* (cid) {\n          yield ensureNotPinned(cid, pins);\n          return cid;\n        });\n\n        return function (_x) {\n          return _ref.apply(this, arguments);\n        };\n      }()), options);\n    },\n\n    batch() {\n      return store.batch();\n    }\n\n  };\n}\n/**\n * @param {CID} cid\n * @param {Pins} pins\n */\n\n\nfunction ensureNotPinned(_x2, _x3) {\n  return _ensureNotPinned.apply(this, arguments);\n}\n\nfunction _ensureNotPinned() {\n  _ensureNotPinned = _asyncToGenerator(function* (cid, pins) {\n    const {\n      pinned,\n      reason\n    } = yield pins.isPinnedWithType(cid, PinTypes.all);\n\n    if (pinned) {\n      throw errCode(new Error(`pinned: ${reason}`), 'ERR_BLOCK_PINNED');\n    }\n  });\n  return _ensureNotPinned.apply(this, arguments);\n}","map":{"version":3,"sources":["/Users/sydneybailey/Internship/Dapp/node_modules/ipfs-repo/src/pinned-blockstore.js"],"names":["map","require","errCode","PinTypes","module","exports","createPinnedBlockstore","pins","store","open","close","query","options","queryKeys","get","cid","getMany","cids","put","buf","putMany","pairs","has","delete","ensureNotPinned","deleteMany","batch","pinned","reason","isPinnedWithType","all","Error"],"mappings":"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","sourcesContent":["'use strict'\n\nconst map = require('it-map')\nconst errCode = require('err-code')\nconst { PinTypes } = require('./pins')\n\n/**\n * @typedef {import('interface-datastore').Query} Query\n * @typedef {import('interface-datastore').Datastore} Datastore\n * @typedef {import('interface-datastore').Options} DatastoreOptions\n * @typedef {import('interface-blockstore').Blockstore} Blockstore\n * @typedef {import('multiformats/cid').CID} CID\n * @typedef {import('./pins').Pins} Pins\n */\n\n/**\n *\n * @param {Blockstore} blockstore\n */\nmodule.exports = createPinnedBlockstore\n\n/**\n * @param {Pins} pins\n * @param {Blockstore} store\n * @returns {Blockstore}\n */\nfunction createPinnedBlockstore (pins, store) {\n  return {\n    open () {\n      return store.open()\n    },\n\n    close () {\n      return store.close()\n    },\n\n    query (query, options) {\n      return store.query(query, options)\n    },\n\n    queryKeys (query, options) {\n      return store.queryKeys(query, options)\n    },\n\n    async get (cid, options) {\n      return store.get(cid, options)\n    },\n\n    async * getMany (cids, options) {\n      yield * store.getMany(cids, options)\n    },\n\n    async put (cid, buf, options) {\n      await store.put(cid, buf, options)\n    },\n\n    async * putMany (pairs, options) {\n      yield * store.putMany(pairs, options)\n    },\n\n    has (cid, options) {\n      return store.has(cid, options)\n    },\n\n    async delete (cid, options) {\n      await ensureNotPinned(cid, pins)\n\n      return store.delete(cid, options)\n    },\n\n    deleteMany (cids, options) {\n      return store.deleteMany(map(cids, async cid => {\n        await ensureNotPinned(cid, pins)\n\n        return cid\n      }), options)\n    },\n\n    batch () {\n      return store.batch()\n    }\n  }\n}\n\n/**\n * @param {CID} cid\n * @param {Pins} pins\n */\nasync function ensureNotPinned (cid, pins) {\n  const { pinned, reason } = await pins.isPinnedWithType(cid, PinTypes.all)\n\n  if (pinned) {\n    throw errCode(new Error(`pinned: ${reason}`), 'ERR_BLOCK_PINNED')\n  }\n}\n"]},"metadata":{},"sourceType":"script"}